<div id=D__ID>
    <section id=form_container__ID>
    	<div id=header__ID>
    		Communal ordering form
    	</div>
    	<form id=F__ID>
			<div>
				<div w='100|100'>
					<span>1. Full name of the requestor</span>
					<input type="text" name=Requestor_Name required />
				</div>
			</div>
			<div>
				<div w='100|100'>
					<span>2. Email the requestor</span>
					<input type="email" name=Requestor_Email required />
				</div>
			</div>
			<div>
				<div w='100|100'>
					<span>3. Date Requested</span>
					<input type=date name=Date ></input>
				</div>
			</div>
			<section style='display:none'>
				<input type="text" name=Status  />
			</section>
			<div>
				<div w='100|100'>
					<button id=draft__ID type="button" class="btn btn-secondary">Save and Return Later</button>
					<button id=submit__ID type="button" class="btn btn-secondary">Submit</button>
					<button id=trigger__ID style='display:none'></button>
				</div>
			</div>
    	</form>
    </section>
    <script>
    	function F__ID(){
    		//-------------------------------------
			VmInclude:__COMPONENT__/f/form.01.js
			new ResizeObserver($vm.responsive).observe(form_container__ID);
			m.storage_type=='s0'
			//-------------------------------------
			var old_m_load=m.load;
			m.load=function(){
				if($vm.user_name=="guest"){
					alert("You haven't login.");
					return;
				}
				old_m_load();
				if(m.input.record!=undefined && m.input.record.Data.Status=="Submit"){
					$('#draft__ID').hide();
					$('#submit__ID').hide();
				}
			}      
			$('#draft__ID').on('click',function(){	$("#F__ID input[name='Status']").val('Draft');  m.options.lock=0; $('#trigger__ID').trigger( "click" ); })
			$('#submit__ID').on('click',function(){	$("#F__ID input[name='Status']").val('Submit'); m.options.lock=1; $('#trigger__ID').trigger( "click" ); })
			//-------------------------------------
            m.before_submit=function(data,index){
				if(m.input.record==undefined){ 		//only for add
					index.A=$vm.user_name; 
				}
                return true;
            }
			//-------------------------------------
			m.after_insert=function(data,res){ after_submit(data,res); }
			m.after_update=function(data,res){ after_submit(data,res); }
			var after_submit=function(data,res){
				if(data.Status=='Submit'){
					var req={cmd:'flow',flowid:'flow_lab_order_submitted',data:data}
					$vm.request(req,function(res){
						$vm.refresh=1;
						m.change_status++;
						if(m.input.goback!=undefined) window.history.go(-1);            //from grid
						else $vm.alert('Your data has been successfully submitted');    //standalone
					});
				}
				else{
					$vm.refresh=1;
					m.change_status++;
					if(m.input.goback!=undefined) window.history.go(-1);            //from grid
					else $vm.alert('Your data has been successfully saved');    //standalone
				}
			}
			//-------------------------------------
		}
    </script>
    <style>
        #form_container__ID{
            max-width:800px;
        }
		VmInclude:__CURRENT_PATH__form.css
        VmInclude:__COMPONENT__/f/form.01.css
		#D__ID{
			background-size: cover; 
			background-repeat: repeat-x; 
			background-position: center top; 
			background-attachment: fixed;
			background-image: url("__CURRENT_PATH__form.jpg");
			background-color: unset;
		}
    </style>
</div>
